---
title: "QCEW API"
author: "Sam Neylon"
date: '2022-07-17'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here)
library(tidyverse)

```

# BLS Guide

U.S. Department of Labor
Bureau of Labor Statistics 
Quarterly Census of Employment and Wages
June 2016

QCEW Open Data Access RScript Example
R Language 3.1.0 
The three functions defined in this file are called at the bottom 
of this script. So, if you run this code, you'll get some results.
Submit questions at: http://www.bls.gov/cgi-bin/forms/cew?/cew/home.htm 


## Area Data

qcewGetAreaData : This function takes a year, quarter, and area argument and
returns an array containing the associated area data. use 'a' for annual
averages. 
For all area codes and titles see:
http://data.bls.gov/cew/doc/titles/area/area_titles.htm

```{r eval=TRUE}

qcewGetAreaData <- function(year, qtr, area) {
	url <- "http://data.bls.gov/cew/data/api/YEAR/QTR/area/AREA.csv"
	url <- sub("YEAR", year, url, ignore.case=FALSE)
	url <- sub("QTR", tolower(qtr), url, ignore.case=FALSE)
	url <- sub("AREA", toupper(area), url, ignore.case=FALSE)
	read.csv(url, header = TRUE, sep = ",", quote="\"", dec=".", na.strings=" ", skip=0)
}

```

## Industry Data

qcewGetIndustryData : This function takes a year, quarter, and industry code
and returns an array containing the associated industry data. Use 'a' for 
annual averages. Some industry codes contain hyphens. The CSV files use
underscores instead of hyphens. So 31-33 becomes 31_33. 
For all industry codes and titles see:
http://data.bls.gov/cew/doc/titles/industry/industry_titles.htm

```{r eval=T}

qcewGetIndustryData <- function (year, qtr, industry) {
	url <- "http://data.bls.gov/cew/data/api/YEAR/QTR/industry/INDUSTRY.csv"
	url <- sub("YEAR", year, url, ignore.case=FALSE)
	url <- sub("QTR", tolower(qtr), url, ignore.case=FALSE)
	url <- sub("INDUSTRY", industry, url, ignore.case=FALSE)
	read.csv(url, header = TRUE, sep = ",", quote="\"", dec=".", na.strings=" ", skip=0)
}

```

## Size Data

qcewGetSizeData : This function takes a year and establishment size class code
and returns an array containing the associated size data. Size data
is only available for the first quarter of each year.
For all establishment size classes and titles see:
http://data.bls.gov/cew/doc/titles/size/size_titles.htm

```{r eval=T}

qcewGetSizeData <- function ( year, size) {
	url <- "http://data.bls.gov/cew/data/api/YEAR/1/size/SIZE.csv"
	url <- sub("YEAR", year, url, ignore.case=FALSE)
	url <- sub("SIZE", size, url, ignore.case=FALSE)
	read.csv(url, header = TRUE, sep = ",", quote="\"", dec=".", na.strings=" ", skip=0)
}

```

## EXAMPLES

```{r eval=FALSE}

 MichiganData <- qcewGetAreaData("2015", "1", "26000")
 Construction <- qcewGetIndustryData("2015", "1", "1012")
 SizeData <- qcewGetSizeData("2015","6")

 # Prints first line of data

MichiganData[1, ]
Construction[1, ]
SizeData[1, ]
 
```


# San Francisco

Geographic Codes: https://data.bls.gov/cew/doc/titles/area/area_titles.htm

MSA Code:
C4186 	San Francisco-Oakland-Hayward, CA MSA

## Variables
```{r eval=T}

sf_yr <- "2018"
sf_area <- "C4186"
sf_qtr <- "a"

```

## Pull Data
```{r eval=T}

sf_Import <- qcewGetAreaData(sf_yr, sf_qtr, sf_area)

```

## Organize NAICS

```{r eval=T}

# NAICS Levels
sf_Data <- sf_Import %>% 
  mutate(NAICS_lvl = if_else((str_length(sf_Import$industry_code)==2), 2, 
                                     if_else((str_length(sf_Import$industry_code)==3), 3, 
                                             if_else((str_length(sf_Import$industry_code)==4), 4, 
                                                     if_else((str_length(sf_Import$industry_code)==5), 5, 6))))
         )

# NAICS substring

sf_Data <- sf_Data %>% mutate(NAICS_1 = str_sub(industry_code, 1, 1),
                              NAICS_2 = str_sub(industry_code, 1, 2),
                              NAICS_3 = ifelse(NAICS_lvl>=3, str_sub(industry_code, 1, 3), NA_character_))

sf_Data <- sf_Data %>% relocate(c("NAICS_lvl","NAICS_1","NAICS_2","NAICS_3"), .after = industry_code)

```


## Filter Industries

```{r eval=T}

lifeSci_NAICS <- c(
  
)

sf_lifeSci <- sf_Data %>% filter()

```

# Mult-Year

```{r eval=F}



```

